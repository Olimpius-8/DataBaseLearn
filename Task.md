# Задание

## Триггеры:
- Проверка пользователя в диалоге на его блокировку
- Проверка пользователя в конференции на его разрешения
- Автодетект стоп слов в любых сообщениях
 
## Процедуры
- `Statistic` Статистика майоров по стоп-словам  
- `CreateListUsers` Добавление *пользователей* с проверкой в контактной книге номера админа на блокировку
 
## Запросы
1) 	Вывести для пользователя: 
* Телефон 
* Nickname
* Кол-во сообщений
* Кол-во людей, которым отправил сообщения
* Кол-во стоп-слов в сообщениях
* Майор, который чаще всего находил совпадения
	
2)	По вертикали: 12 месяцев от текущего назад на год
	По горизонтали:    	
* Кол-во найденных случаев всеми майорами за месяц (случаев - не количество слов по сообщениям)
* Суммарная длина звонков
* Топ пользователь чата

3) 	По вертикали: 4 квартала
        По горизонтали: 
    * Средняя длина сообщения в квартале
    * Кол-во засветившихся пользователей
    * Кол-во вложений за квартал

4)	Для каждого майора: ФИО, ID, Кол-во найденных слов, Ранг по количеству найденных слов

5)	Для засветившихся пользователей (топ 30) вывести  кол-во засветов и одним атрибутом список контактов (ФИО;  ... ФИО)

# Вспомогательные разработки
## Представления
- рекурсивный подсчёт вложений по сообщению
## Триггеры
- триггер заменяет операцию удаления сообщения изменением атрибута `deleted` на 1
- автоподсчёт количества времени разговора

## Функции
- подсчёт кол-ва совпадений у майора по сообщениям и звонкам

## Процедуры
- `printMajorsDictionary`		- Вывод словаря текущего майора
- `printCurrentMajorDictionary`	- Вывод словарей майоров
- `printContactBook`			- Вывод общей контактной книги

Для оптимизации запросов использовался материал: https://falcon.web-automation.ru/list/sqlserver/sql--optimizaciya-zaprosov-sql---66